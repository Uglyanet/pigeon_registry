version: "3"

services:

  nginx-router:
    networks: { default: { aliases: ['pigeon.local'] } }
    image: docker.pkg.github.com/uglyanet/pigeon_registry/pigeon_nginx:latest
    restart: always
    ports: ['80:80']
    volumes: ['images-cache:/data/nginx/cache']
    depends_on: [ 'backend', 'frontend' ]

  backend:
    image: docker.pkg.github.com/uglyanet/pigeon_registry/pigeon_server:latest
    restart: always
    command: node index.js

  frontend:
    image: docker.pkg.github.com/uglyanet/pigeon_registry/pigeon_client:latest
    restart: always
    command: nginx -g 'daemon off';
    depends_on:
      - server
